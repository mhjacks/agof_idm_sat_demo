---
# This play creates the Content View Filters for a Content View
#

- name: "Create the content view filter {{ cvf.name }}"
  katello_content_view_filter:
    username: "{{ foreman_admin_username }}"
    password: "{{ foreman_admin_password }}"
    server_url: "{{ foreman_server_url }}"
    organization: "{{ foreman_initial_organization }}"
    validate_certs: "{{ foreman_validate_certs }}"
    name: "{{ cvf.name }}"
    description: "{{ cvf.description }}"
    content_view: "{{ cv.name }}"
    filter_type: "{{ cvf.type }}"
    inclusion: "{{ cvf.inclusion }}"
    original_packages: "{{ cvf.original_packages }}"
    repositories: "{{ cvf.repositories }}"
    filter_state: present
  when: "cvf.type == 'rpm'"

- name: "Create the content view filter {{ cvf.name }}"
  katello_content_view_filter:
    username: "{{ foreman_admin_username }}"
    password: "{{ foreman_admin_password }}"
    server_url: "{{ foreman_server_url }}"
    organization: "{{ foreman_initial_organization }}"
    validate_certs: "{{ foreman_validate_certs }}"
    name: "{{ cvf.name }}"
    description: "{{ cvf.description }}"
    content_view: "{{ cv.name }}"
    filter_type: "{{ cvf.type }}"
    inclusion: "{{ cvf.inclusion }}"
    repositories: "{{ cvf.repositories }}"
    filter_state: present
  when: "cvf.type == 'erratum'"


- name: "Configure Content View Filter Rules"
  include_tasks: create_cvf_rules.yml
  loop: "{{ cvf.rules }}"
  loop_control:
    loop_var: cvfr
  when: "cvf.rules is defined"

